<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dodge the Squares – ABSURD MODE</title>
<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    display: block;
    margin: 10px auto;
    background: #080808;
    border: 3px solid #400;
  }
</style>
</head>
<body>

<h1>☠ DODGE THE SQUARES ☠</h1>
<p>← → / A D to move | SHIFT to dash | Survive (lol)</p>
<canvas id="game" width="420" height="520"></canvas>
<p id="hud"></p>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

let score = 0;
let difficulty = 1;
let gameOver = false;
let shake = 0;

const player = {
  x: 200,
  y: 470,
  size: 18,
  speed: 5,
  dashCooldown: 0
};

let enemies = [];
let lasers = [];
let arena = 0;

function spawnEnemy() {
  const type = Math.random();
  enemies.push({
    x: Math.random() * (canvas.width - 20),
    y: -20,
    size: 16,
    speed: 2 + difficulty * 0.4,
    homing: type < 0.35
  });
}

function spawnLaser() {
  const x = Math.random() * canvas.width;
  lasers.push({ x, timer: 60 });
}

function update() {
  if (gameOver) return;

  difficulty += 0.003;
  arena = Math.min(80, difficulty * 4);
  score++;

  let left = arena;
  let right = canvas.width - player.size - arena;

  if ((keys["ArrowLeft"] || keys["a"]) && player.x > left)
    player.x -= player.speed;
  if ((keys["ArrowRight"] || keys["d"]) && player.x < right)
    player.x += player.speed;

  // DASH
  if (keys["Shift"] && player.dashCooldown <= 0) {
    player.x += (keys["ArrowLeft"] || keys["a"] ? -1 : 1) * 80;
    player.dashCooldown = 120;
  }
  if (player.dashCooldown > 0) player.dashCooldown--;

  // Enemies
  for (let e of enemies) {
    if (e.homing) {
      e.x += Math.sign(player.x - e.x) * 1.5;
    }
    e.y += e.speed;

    if (
      player.x < e.x + e.size &&
      player.x + player.size > e.x &&
      player.y < e.y + e.size &&
      player.y + player.size > e.y
    ) gameOver = true;

    if (Math.abs(player.y - e.y) < 10) shake = 8;
  }

  enemies = enemies.filter(e => e.y < canvas.height + 50);

  // Lasers
  for (let l of lasers) {
    l.timer--;
    if (l.timer === 0) {
      if (Math.abs(player.x - l.x) < 10) gameOver = true;
    }
  }
  lasers = lasers.filter(l => l.timer > -20);
}

function draw() {
  ctx.save();
  if (shake > 0) {
    ctx.translate(Math.random()*shake, Math.random()*shake);
    shake--;
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Arena walls
  ctx.fillStyle = "#220000";
  ctx.fillRect(0, 0, arena, canvas.height);
  ctx.fillRect(canvas.width - arena, 0, arena, canvas.height);

  // Player
  ctx.fillStyle = "dodgerblue";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // Enemies
  for (let e of enemies) {
    ctx.fillStyle = e.homing ? "orange" : "red";
    ctx.fillRect(e.x, e.y, e.size, e.size);
  }

  // Lasers
  for (let l of lasers) {
    ctx.strokeStyle = l.timer > 0 ? "yellow" : "red";
    ctx.beginPath();
    ctx.moveTo(l.x, 0);
    ctx.lineTo(l.x, canvas.height);
    ctx.stroke();
  }

  if (gameOver) {
    ctx.fillStyle = "white";
    ctx.font = "32px monospace";
    ctx.fillText("NOPE.", 160, 250);
  }

  ctx.restore();

  document.getElementById("hud").textContent =
    `Score: ${score} | Difficulty: ${difficulty.toFixed(1)} | Dash CD: ${player.dashCooldown}`;
}

setInterval(() => {
  if (!gameOver) {
    spawnEnemy();
    if (difficulty > 5) spawnEnemy();
    if (difficulty > 7 && Math.random() < 0.3) spawnLaser();
  }
}, 600);

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
